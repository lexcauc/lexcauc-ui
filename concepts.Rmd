---
title: "Concepts"
---

```{r, include=FALSE}
source("shared.R")
```

```{r,include=FALSE,eval=FALSE}
# Generate concept pages

sapply(seq_along(concepts$no),function(i){
    title <- paste0("## ", concepts$no[i], ". ", concepts$rus[i])
    def <- paste0("### Определение", "\n", ifelse(is.na(concepts$def_RU[i]), "", concepts$def_RU[i]), "\n")
    ctx <- paste0("### Контексты", "\n", ifelse(is.na(concepts$cx_RU[i]), "", concepts$cx_RU[i]), "\n")
    text <- c(title, def, ctx)
    writeLines(text,paste0(concepts$no[i],"_RU.Rmd"))
  })

sapply(seq_along(concepts$no),function(i){
    title <- paste0("## ", concepts$no[i], ". ", concepts$eng[i])
    def <- paste0("### Definition", "\n", ifelse(is.na(concepts$def_EN[i]), "", concepts$def_EN[i]), "\n")
    ctx <- paste0("### Contexts", "\n", ifelse(is.na(concepts$cx_EN[i]), "", concepts$cx_EN[i]), "\n")
    text <- c(title, def, ctx)
    writeLines(text,paste0(concepts$no[i],"_EN.Rmd"))
  })
```

```{r render table 1}

# Place links to concept definitions
mutate(concepts,rus = paste0("<a href = '",
                       no,
                        "_RU.html' target='_blank'>",
                        rus,
                        "</a>"),
          eng = paste0("<a href = '",
                        no,
                        "_EN.html' target='_blank'>",
                        eng,
                        "</a>")) ->
concepts

# Filter out only main counterparts for comparative concepts
filter(forms, aux == "" & excl == "" & lc.id != 0) -> display

# Add Russian and English columns and remove unnecessary columns
mutate(display, rus = "",
                eng = "",
                subentry = NULL,
                aux = NULL,
                excl = NULL,
                gender = as.factor(gender),
                lang = as.factor(lang)) -> display

# Populate Russian and English columns with corresponding names and URLs
# for(i in 1:nrow(display)) {
#  display$rus[i] <- concepts$rus[concepts$no == display$lc.id[i]]
#  display$eng[i] <- concepts$eng[concepts$no == display$lc.id[i]]
#}

# Collapse lexeme variants into single rows, spread the table
  display %>% group_by(lc.id,lang) %>% mutate(orthographic = paste(orthographic, collapse="; "), phonemic = paste(phonemic, collapse="; "), ipa = paste(ipa, collapse="; ")) %>% slice(1) %>% ungroup() %>% group_by(lex.id,lang) %>% mutate(orthographic = paste(orthographic, collapse=", "), phonemic = paste(phonemic, collapse=", "), ipa = paste(ipa, collapse=", ")) %>% slice(1) %>% ungroup() %>% transmute(id = lc.id, rus = rus, eng = eng, orthographic = orthographic, phonemic = phonemic, ipa = ipa, lang = lang) %>% gather("type","text",ipa,phonemic,orthographic) %>% unite(lang.type, c(lang,type), sep = ".")  %>% spread(lang.type,text) -> display.spread

# Replace the concept numbers with corresponding names and URLs
for(i in 1:nrow(display.spread)) {
 #display$rus[i] <- concepts$rus[concepts$no == display$rus[i]]
 concepts %>% filter(no == display.spread$id[i]) %>% select(rus) -> display.spread$rus[i]
 concepts %>% filter(no == display.spread$id[i]) %>% select(eng) -> display.spread$eng[i]  
 #display$eng[i] <- concepts$eng[concepts$no == display$eng[i]]
}

# Display the table
  datatable(display.spread,escape = FALSE, rownames = FALSE,
            extensions = c('ColReorder', 'Buttons', 'FixedHeader'),
            filter = list(position = 'top', clear = TRUE),
            options = list(
              dom = 'Btip', 
              autoWidth = TRUE, 
              colReorder = TRUE, 
              buttons = I('colvis'),
              fixedHeader = TRUE,
              pageLength = 20))
```